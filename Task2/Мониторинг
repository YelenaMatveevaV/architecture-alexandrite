Выбор и настройка мониторинга в системе

1. Мотивация
Мониторинг систем необходим для:
1) анализ производительности систем
2) анализ достаточности ресурсов
3) уведомление о наступающей проблеме и об экстренных ситуациях, требующих вмешательства
4) запуск автоматизированных скриптов для нивелирования проблемных ситуаций

Что в свою очередь влияет на доступность сервисов и удовлетворенность клиентов и сотрудников.

2. Выбор подхода к мониторингу

Внедрение мониторинга систем можно начать с настройки базовых метрик по методам USE, RED, четыре золотых правила.
Далее для систем можно нарастить показатели в зависимости от особенностей эксплуатации и наличия узки мест.

Метод USE выбран для следующих систем:
1) MES API
2) Shop API
3) CRM API
Причины: метод подходит для сервисов, снижающих производительность при высокой нагрузке

Метод четырех золотых правил выбран для следующих систем:
1) Internet Shop
2) CRM
3) MES
Причины: содержит показатели, важные для оценки работы сервиса для пользователей

Метод RED:
1) Message Queue
2) 3d files storage
Причины: позволит оценить показатели работоспособности внутренних сервисов

Показатели мониторинга БД для:
1) Shop DB
2) MES DB
Причины: специфические показатели по работе БД для анализа ресурсов и производительности

3. Анализ списка метрик

Для систем выбраны базовые методы по сбору метрик и с них рекомендуется начать при разворачивании системы мониторинга. Дополнительные метрики можно будет добавлять при вывялении требовании к системам, которым они перестали удовлетворять.
С учетом наличия жалоб при передаче заявок в производство предлагаю проанализировать логи БД для определения наличия системных проблем, проанализировать данные БД для определения причин проблем на уровне решения, добавить бизнес-показатели для систем MES, MES API при выявлении узких мест или для сбора дополнительных сведений.
Системные показатели RAM, CPU, размер дискового пространства можно базово добавить для всех систем и настроить alert при достижении близких к критическим значениям.


Number of dead-letter-exchange letters in RabbitMQ  - счетчик количества необработанных из-за ошибок сообщений можно добавить к системе Message Queue
Number of message in flight in RabbitMQ - счетчик количества доставленных, но не подтвержденных сообщений, можно добавить к системе Message Queue
Number of requests (RPS) for internet shop API - количество запросов, которые API успешно обрабатывает за одну секунду. Можно добавить к Shop API
Number of requests (RPS) for CRM API - количество запросов, которые CRM API успешно обрабатывает за одну секунду. 
Number of requests (RPS) for MES API - количество запросов, которые MES API успешно обрабатывает за одну секунду.
Number of requests (RPS) per user for internet shop API - метрика, показывающая, сколько запросов в среднем делает один пользователь к API интернет-магазина за одну секунду. Может понадобиться для оптимизаций процессов взаимодействия.
Number of requests (RPS) per user for CRM API - метрика, показывающая, сколько запросов в среднем делает один пользователь к API CRM за одну секунду. Может понадобиться для оптимизаций процессов взаимодействия.
Number of requests (RPS) per user for MES API - метрика, показывающая, сколько запросов в среднем делает один пользователь к API MES за одну секунду. Может понадобиться для оптимизаций процессов взаимодействия.
CPU % for shop API - метрика, показывающая, какую долю процессорного времени занимает обработка запросов API. Она помогает оценить нагрузку на сервер и эффективность использования ресурсов. Может понадобиться для оценки необходимости масштабирования сервиса.
CPU % for CRM API - метрика, показывающая, какую долю процессорного времени занимает обработка запросов API. Она помогает оценить нагрузку на сервер и эффективность использования ресурсов. Может понадобиться для оценки необходимости масштабирования сервиса.
CPU % for MES API - метрика, показывающая, какую долю процессорного времени занимает обработка запросов API. Она помогает оценить нагрузку на сервер и эффективность использования ресурсов. Может понадобиться для оценки необходимости масштабирования сервиса.
Memory Utilisation for shop API - метрика, отражающая объём оперативной памяти (RAM), который используется API интернет-магазина во время работы. Мониторинг этого показателя важен для поддержания стабильности, производительности и предотвращения утечек памяти или перегрузки системы
Memory Utilisation for CRM API - метрика, отражающая объём оперативной памяти (RAM), который используется API CRM во время работы. Мониторинг этого показателя важен для поддержания стабильности, производительности и предотвращения утечек памяти или перегрузки системы
Memory Utilisation for MES API - метрика, отражающая объём оперативной памяти (RAM), который используется API MES во время работы. Мониторинг этого показателя важен для поддержания стабильности, производительности и предотвращения утечек памяти или перегрузки системы
Memory Utilisation for shop db instance - показатель, отражающий, сколько оперативной памяти используется базой данных для хранения данных, кэширования, выполнения запросов и других операций.
Memory Utilisation for MES db instance - показатель, отражающий, сколько оперативной памяти используется базой данных для хранения данных, кэширования, выполнения запросов и других операций.
Number of connections for shop db instance - это метрика, показывающая текущее количество активных соединений с базой данных интернет-магазина. Мониторинг этого показателя помогает контролировать нагрузку на базу, предотвращать исчерпание лимитов соединений и обеспечивать стабильную работу сервиса.
Number of connections for MES db instance - это метрика, показывающая текущее количество активных соединений с базой данных MES. Мониторинг этого показателя помогает контролировать нагрузку на базу, предотвращать исчерпание лимитов соединений и обеспечивать стабильную работу сервиса.
Response time (latency) for shop API - это ключевая метрика, показывающая, сколько времени в среднем занимает полный цикл обработки запроса: от момента отправки клиентом до получения ответа. Она включает в себя как сетевую задержку (latency), так и время обработки на сервере. 
Response time (latency) for CRM API  - это ключевая метрика, показывающая, сколько времени в среднем занимает полный цикл обработки запроса: от момента отправки клиентом до получения ответа. Она включает в себя как сетевую задержку (latency), так и время обработки на сервере. 
Response time (latency) for MES API  - это ключевая метрика, показывающая, сколько времени в среднем занимает полный цикл обработки запроса: от момента отправки клиентом до получения ответа. Она включает в себя как сетевую задержку (latency), так и время обработки на сервере. 
Size of S3 storage - метрика отражает общий объём данных в байтах, хранящихся в бакете, включая все объекты, метаданные и части незавершённых multipart-загрузок.
Size of shop db instance - метрика отражает общий объём данных в байтах, хранящихся в бакете, включая все объекты, метаданные и части незавершённых multipart-загрузок.
Size of MES db instance - метрика отражает общий объём данных в байтах, хранящихся в бакете, включая все объекты, метаданные и части незавершённых multipart-загрузок.
Number of HTTP 200 for shop API - это метрика, показывающая количество успешных HTTP-запросов к API интернет-магазина, которые завершились с кодом состояния 200 OK. Код 200 означает, что запрос был успешно обработан сервером, и клиент получил ожидаемый ответ
Number of HTTP 200 for CRM API - это метрика, показывающая количество успешных HTTP-запросов к API CRM, которые завершились с кодом состояния 200 OK. Код 200 означает, что запрос был успешно обработан сервером, и клиент получил ожидаемый ответ
Number of HTTP 200 for MES API - это метрика, показывающая количество успешных HTTP-запросов к API MES, которые завершились с кодом состояния 200 OK. Код 200 означает, что запрос был успешно обработан сервером, и клиент получил ожидаемый ответ
Number of HTTP 500 for shop API - это метрика, отражающая количество ответов API интернет-магазина с кодом состояния HTTP 500 Internal Server Error за определённый период времени.
Number of HTTP 500 for CRM API - это метрика, отражающая количество ответов API CRM с кодом состояния HTTP 500 Internal Server Error за определённый период времени.
Number of HTTP 500 for MES API - это метрика, отражающая количество ответов API MES с кодом состояния HTTP 500 Internal Server Error за определённый период времени.
Number of simultanious sessions for shop API - это метрика, отражающая количество активных пользовательских сессий, которые одновременно поддерживаются API интернет-магазина.
Number of simultanious sessions for CRM API - это метрика, отражающая количество активных пользовательских сессий, которые одновременно поддерживаются API CRM.
Number of simultanious sessions for MES API - это метрика, отражающая количество активных пользовательских сессий, которые одновременно поддерживаются API MES.
Kb tranferred (received) for shop API - это метрика, отражающая объём данных (в килобайтах), полученных API интернет-магазина за определённый период времени. Она показывает, сколько информации было принято сервером от клиентов через API.
Kb tranferred (received) for CRM API - это метрика, отражающая объём данных (в килобайтах), полученных API CRM за определённый период времени. Она показывает, сколько информации было принято сервером от клиентов через API.
Kb tranferred (received) for MES API - это метрика, отражающая объём данных (в килобайтах), полученных API MES за определённый период времени. Она показывает, сколько информации было принято сервером от клиентов через API.
Kb provided (sent) for shop API - это метрика, показывающая объём данных (в килобайтах), которые API интернет-магазина отправляет клиентам в ответах за определённый период времени.
Kb provided (sent) for CRM API - это метрика, показывающая объём данных (в килобайтах), которые API CRM отправляет клиентам в ответах за определённый период времени.
Kb provided (sent) for MES API - это метрика, показывающая объём данных (в килобайтах), которые API MES отправляет клиентам в ответах за определённый период времени.